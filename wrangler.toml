name = "umbrella-api"
main = "api/index.ts"
compatibility_date = "2024-01-01"

# Environment variables
[vars]
USE_MOCKS = "true"  # Use mock services for development (set to "false" in M10 for real services)

# Clerk Configuration (add actual keys from Clerk dashboard)
# CLERK_PUBLISHABLE_KEY = "pk_test_..."  # Get from Clerk dashboard
# CLERK_SECRET_KEY = "sk_test_..."       # Get from Clerk dashboard (KEEP SECRET)
# CLERK_WEBHOOK_SECRET = "whsec_..."     # Get from Clerk webhook settings (KEEP SECRET)

# Assets configuration for serving frontend as SPA from Workers
[assets]
directory = "./dist"
binding = "ASSETS"
not_found_handling = "single-page-application"

# Preview environment (for PR deployments)
[env.preview]
name = "umbrella-api-preview"

[[env.preview.d1_databases]]
binding = "DB"
database_name = "umbrella-dev-db"
database_id = "4fbcb5f8-5fe5-4bb1-b56f-0de1e80d6e8a"

[[env.preview.kv_namespaces]]
binding = "KV"
id = "04fceb9a09054bbd991d5252a9a169cf"

# R2 bucket commented out - will add when credit card is available
# [[env.preview.r2_buckets]]
# binding = "BUCKET"
# bucket_name = "umbrella-dev-media"

# Development environment (for local testing)
[env.dev]
name = "umbrella-api-dev"

[[env.dev.d1_databases]]
binding = "DB"
database_name = "umbrella-dev-db"
database_id = "4fbcb5f8-5fe5-4bb1-b56f-0de1e80d6e8a"

[[env.dev.kv_namespaces]]
binding = "KV"
id = "04fceb9a09054bbd991d5252a9a169cf"

# R2 bucket commented out
# [[env.dev.r2_buckets]]
# binding = "BUCKET"
# bucket_name = "umbrella-dev-media"

# Staging environment (for future use)
[env.staging]
name = "umbrella-api-staging"

[[env.staging.d1_databases]]
binding = "DB"
database_name = "umbrella-dev-db"
database_id = "4fbcb5f8-5fe5-4bb1-b56f-0de1e80d6e8a"

[[env.staging.kv_namespaces]]
binding = "KV"
id = "04fceb9a09054bbd991d5252a9a169cf"

# Production environment
[env.production]
name = "umbrella-prod"
workers_dev = false
# Custom domain configuration (requires DNS setup)
# route = "umbrella.app/*"

# Production database binding
[[env.production.d1_databases]]
binding = "DB"
database_name = "umbrella-prod-db"
# database_id will be set after creating the production database via:
# wrangler d1 create umbrella-prod-db --env production

# Production KV namespace binding
[[env.production.kv_namespaces]]
binding = "KV"
# id will be set after creating the production KV namespace via:
# wrangler kv:namespace create KV --env production
# id = "production-kv-id"

# Production R2 bucket binding
[[env.production.r2_buckets]]
binding = "BUCKET"
bucket_name = "umbrella-prod"
# Bucket should be created via:
# wrangler r2 bucket create umbrella-prod

# Production cron triggers
# Analytics aggregation: Daily at midnight UTC
[env.production.triggers]
crons = ["0 0 * * *"]

# Development/Staging cron triggers
[triggers]
crons = ["0 0 * * *"]
