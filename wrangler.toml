name = "umbrella-api"
main = "api/index.ts"
compatibility_date = "2024-01-01"

# Assets configuration for serving frontend (Workers, not Pages!)
[assets]
directory = "./dist"
binding = "ASSETS"
not_found_handling = "single-page-application"

# Preview environment (for PR deployments)
[env.preview]
name = "umbrella-api-preview"

[[env.preview.d1_databases]]
binding = "DB"
database_name = "umbrella-dev-db"  # Use dev DB for preview
database_id = "TBD"

[[env.preview.kv_namespaces]]
binding = "KV"
id = "TBD"

[[env.preview.r2_buckets]]
binding = "BUCKET"
bucket_name = "umbrella-dev-media"  # Use dev bucket for preview

# Development environment
[env.dev]
name = "umbrella-api-dev"

[[env.dev.d1_databases]]
binding = "DB"
database_name = "umbrella-dev-db"
database_id = "TBD"  # Add after creation with: wrangler d1 create umbrella-dev-db

[[env.dev.kv_namespaces]]
binding = "KV"
id = "TBD"  # Add after creation with: wrangler kv:namespace create KV --preview

[[env.dev.r2_buckets]]
binding = "BUCKET"
bucket_name = "umbrella-dev-media"
# Note: Create with: wrangler r2 bucket create umbrella-dev-media

# Staging environment
[env.staging]
name = "umbrella-api-staging"

[[env.staging.d1_databases]]
binding = "DB"
database_name = "umbrella-staging-db"
database_id = "TBD"  # Add after creation

[[env.staging.kv_namespaces]]
binding = "KV"
id = "TBD"  # Add after creation

[[env.staging.r2_buckets]]
binding = "BUCKET"
bucket_name = "umbrella-staging-media"

# Production environment
[env.production]
name = "umbrella-api-production"

[[env.production.d1_databases]]
binding = "DB"
database_name = "umbrella-prod-db"
database_id = "TBD"  # Add after creation

[[env.production.kv_namespaces]]
binding = "KV"
id = "TBD"  # Add after creation

[[env.production.r2_buckets]]
binding = "BUCKET"
bucket_name = "umbrella-prod-media"
